{% extends "base.html" %}

{% block title %}Planespotter - Aircraft {{ icao24 }}{% endblock %}

{% block content %}
<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="/search"><i class="bi bi-search me-1"></i>Search</a></li>
        <li class="breadcrumb-item active"><code>{{ icao24 }}</code></li>
    </ol>
</nav>

{% if error %}
<div class="alert alert-danger d-flex align-items-center">
    <i class="bi bi-exclamation-triangle me-2"></i>
    {{ error }}
</div>
{% endif %}

{% if aircraft %}
<!-- Header with status -->
<div class="card mb-4">
    <div class="card-body">
        <div class="row align-items-center">
            <div class="col-auto">
                <div class="aircraft-icon {% if aircraft['is_airborne'] %}airborne{% endif %}" style="width: 80px; height: 80px;">
                    <i class="bi bi-airplane fs-2"></i>
                </div>
            </div>
            <div class="col">
                <h2 class="mb-1">
                    {{ aircraft['registration'] or aircraft['icao24'] }}
                    {% if aircraft['is_airborne'] %}
                    <span class="badge bg-success ms-2">
                        <span class="pulse me-1" style="display: inline-block; width: 8px; height: 8px;"></span>
                        Airborne
                    </span>
                    {% endif %}
                </h2>
                <p class="mb-0 text-muted">
                    {{ aircraft['manufacturername'] or 'Unknown' }} {{ aircraft['model'] or '' }}
                    {% if aircraft['typecode'] %}<code class="ms-2">{{ aircraft['typecode'] }}</code>{% endif %}
                </p>
            </div>
            <div class="col-auto">
                <code style="font-size: 1.5rem;">{{ aircraft['icao24'] }}</code>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <!-- Live Position Card -->
    <div class="col-lg-6 mb-4">
        <div class="card h-100">
            <div class="card-header d-flex justify-content-between align-items-center">
                <span><i class="bi bi-broadcast me-2"></i>Live Position</span>
                {% if aircraft['is_airborne'] %}
                <span class="airborne-badge">
                    <span class="pulse"></span>
                    <small>Live</small>
                </span>
                {% endif %}
            </div>
            <div class="card-body">
                {% if aircraft['position'] %}
                {% set pos = aircraft['position'] %}
                <div class="info-grid mb-4">
                    <div class="info-item">
                        <label>Callsign</label>
                        <span>{{ pos['callsign'] or '-' }}</span>
                    </div>
                    <div class="info-item">
                        <label>Country</label>
                        <span>{{ pos['origin_country'] or '-' }}</span>
                    </div>
                    <div class="info-item">
                        <label>Latitude</label>
                        <span>{{ "%.4f°"|format(pos['latitude']) if pos['latitude'] else '-' }}</span>
                    </div>
                    <div class="info-item">
                        <label>Longitude</label>
                        <span>{{ "%.4f°"|format(pos['longitude']) if pos['longitude'] else '-' }}</span>
                    </div>
                    <div class="info-item">
                        <label>Altitude</label>
                        <span>{{ "%.0f m"|format(pos['baro_altitude']) if pos['baro_altitude'] else '-' }}</span>
                    </div>
                    <div class="info-item">
                        <label>Speed</label>
                        <span>{{ "%.0f m/s"|format(pos['velocity']) if pos['velocity'] else '-' }}</span>
                    </div>
                    <div class="info-item">
                        <label>Heading</label>
                        <span>{{ "%.0f°"|format(pos['true_track']) if pos['true_track'] else '-' }}</span>
                    </div>
                    <div class="info-item">
                        <label>Vertical Rate</label>
                        <span>{{ "%.0f m/s"|format(pos['vertical_rate']) if pos['vertical_rate'] else '-' }}</span>
                    </div>
                </div>
                {% if pos['latitude'] and pos['longitude'] %}
                <div id="aircraft-map" style="height: 250px; border-radius: 4px; margin-top: 1rem;"></div>
                <script>
                    var map = L.map('aircraft-map').setView([{{ pos['latitude'] }}, {{ pos['longitude'] }}], 8);
                    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        attribution: '&copy; OpenStreetMap contributors'
                    }).addTo(map);

                    // Custom airplane icon
                    var planeIcon = L.divIcon({
                        html: '<i class="bi bi-airplane-fill" style="font-size: 24px; color: #62d862; transform: rotate({{ pos['true_track'] or 0 }}deg);"></i>',
                        className: 'aircraft-marker',
                        iconSize: [24, 24],
                        iconAnchor: [12, 12]
                    });

                    L.marker([{{ pos['latitude'] }}, {{ pos['longitude'] }}], {icon: planeIcon})
                        .addTo(map)
                        .bindPopup('<strong>{{ aircraft["registration"] or aircraft["icao24"] }}</strong><br>{{ pos["callsign"] or "N/A" }}<br>Alt: {{ pos["baro_altitude"]|int if pos["baro_altitude"] else "N/A" }}m');
                </script>
                {% endif %}
                {% else %}
                <div class="text-center py-4">
                    <i class="bi bi-wifi-off fs-1 mb-3" style="color: var(--ps-gray);"></i>
                    <h6>Not Currently Tracked</h6>
                    <p class="text-muted mb-0">
                        Position data is only available when the aircraft is airborne and transmitting ADS-B signals.
                    </p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Aircraft Info Card -->
    <div class="col-lg-6 mb-4">
        <div class="card h-100">
            <div class="card-header">
                <i class="bi bi-airplane me-2"></i>Aircraft Details
            </div>
            <div class="card-body">
                <div class="info-grid">
                    <div class="info-item">
                        <label>Manufacturer</label>
                        <span>{{ aircraft['manufacturername'] or '-' }}</span>
                    </div>
                    <div class="info-item">
                        <label>Model</label>
                        <span>{{ aircraft['model'] or '-' }}</span>
                    </div>
                    <div class="info-item">
                        <label>Type Code</label>
                        <span>{{ aircraft['typecode'] or '-' }}</span>
                    </div>
                    <div class="info-item">
                        <label>Serial Number</label>
                        <span>{{ aircraft['serialnumber'] or '-' }}</span>
                    </div>
                    <div class="info-item">
                        <label>Year Built</label>
                        <span>{{ aircraft['built'] or '-' }}</span>
                    </div>
                    <div class="info-item">
                        <label>First Flight</label>
                        <span>{{ aircraft['firstflightdate'] or '-' }}</span>
                    </div>
                    <div class="info-item">
                        <label>Aircraft Type</label>
                        <span>{{ aircraft['aircrafttype'] or '-' }}</span>
                    </div>
                    <div class="info-item">
                        <label>Engines</label>
                        <span>{{ aircraft['engines'] or '-' }}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Owner & Operator Card -->
    <div class="col-lg-6 mb-4">
        <div class="card h-100">
            <div class="card-header">
                <i class="bi bi-building me-2"></i>Owner & Operator
            </div>
            <div class="card-body">
                <div class="info-grid">
                    <div class="info-item">
                        <label>Owner</label>
                        <span>{{ aircraft['owner'] or '-' }}</span>
                    </div>
                    <div class="info-item">
                        <label>Operator</label>
                        <span>{{ aircraft['operator'] or '-' }}</span>
                    </div>
                    <div class="info-item">
                        <label>Operator ICAO</label>
                        <span>{{ aircraft['operatoricao'] or '-' }}</span>
                    </div>
                    <div class="info-item">
                        <label>Operator IATA</label>
                        <span>{{ aircraft['operatoriata'] or '-' }}</span>
                    </div>
                    <div class="info-item">
                        <label>Callsign</label>
                        <span>{{ aircraft['operatorcallsign'] or '-' }}</span>
                    </div>
                    <div class="info-item">
                        <label>Country</label>
                        <span>{{ aircraft['position']['origin_country'] if aircraft['position'] else '-' }}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Registration Card -->
    <div class="col-lg-6 mb-4">
        <div class="card h-100">
            <div class="card-header">
                <i class="bi bi-file-earmark-text me-2"></i>Registration
            </div>
            <div class="card-body">
                <div class="info-grid">
                    <div class="info-item">
                        <label>Registration</label>
                        <span>{{ aircraft['registration'] or '-' }}</span>
                    </div>
                    <div class="info-item">
                        <label>Status</label>
                        <span>{{ aircraft['status'] or '-' }}</span>
                    </div>
                    <div class="info-item">
                        <label>Registered</label>
                        <span>{{ aircraft['registered'] or '-' }}</span>
                    </div>
                    <div class="info-item">
                        <label>Valid Until</label>
                        <span>{{ aircraft['reguntil'] or '-' }}</span>
                    </div>
                    <div class="info-item">
                        <label>ADS-B</label>
                        <span>{{ aircraft['adsb'] or '-' }}</span>
                    </div>
                    <div class="info-item">
                        <label>Mode-S</label>
                        <span>{{ aircraft['modes'] or '-' }}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% if aircraft['notes'] %}
<div class="card">
    <div class="card-header">
        <i class="bi bi-sticky me-2"></i>Notes
    </div>
    <div class="card-body">
        <p class="mb-0">{{ aircraft['notes'] }}</p>
    </div>
</div>
{% endif %}
{% endif %}
{% endblock %}
